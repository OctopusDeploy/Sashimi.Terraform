FROM amazonlinux:2

VOLUME /publish
# Don't call home
ENV DOTNET_CLI_TELEMETRY_OPTOUT=1
# Path to Calamari exe
ENV CalamariBinaries_RelativePath=/publish/Calamari.Terraform/linux-x64
# Forces CI
ENV TEAMCITY_VERSION=1.2.3

RUN rpm -Uvh https://packages.microsoft.com/config/centos/7/packages-microsoft-prod.rpm && \
    yum -y update && \
    yum -y install dotnet-sdk-3.1 && \
    yum -y clean all

WORKDIR /publish/Sashimi.Terraform.Tests

ENTRYPOINT ["dotnet", "vstest", "Sashimi.Terraform.Tests.dll", "--TestCaseFilter:TestCategory != Windows", "--logger:trx"]